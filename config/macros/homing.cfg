# DO NOT EDIT THIS FILE.
# This file is part of a git repository, your changes may prevent updates

[homing_override]
axes:xyz
gcode:
    {% set HOME_CUR = 0.6 %}
    {% set driver_config = printer.configfile.settings['tmc2240 stepper_x'] %}
    {% set RUN_CUR = driver_config.run_current %}
    {% set HOME_X = params.X %}
    {% set HOME_Y = params.Y %}
    {% set HOME_Z = params.Z %}
    M204 S10000
    {% if (HOME_X is undefined) and (HOME_Y is undefined) and (HOME_Z is undefined) %}
        {% set HOME_X = 1 %}
        {% set HOME_Y = 1 %}
        {% set HOME_Z = 1 %}
        {% set HOME_ALL = 1 %}

        SET_KINEMATIC_POSITION Z={printer.toolhead.axis_maximum.z-5}
        G91
        G1 Z5 F600
        {% if printer.save_variables.variables.at_bucket %}
            SET_KINEMATIC_POSITION X=70
            SET_KINEMATIC_POSITION Y=254
            LEAVE_BUCKET
        {% else %}
            SET_KINEMATIC_POSITION X=0
            SET_KINEMATIC_POSITION Y=0
            G1 X10 F2400
            G1 Y10 F2400
        {% endif %}
        G4 P2000
    {% endif %}

    {% if HOME_Y is defined %}
        SET_TMC_CURRENT STEPPER=stepper_y CURRENT={HOME_CUR}
        G28 Y
        SET_TMC_CURRENT STEPPER=stepper_y CURRENT={RUN_CUR}
        BEEP I=1 DUR=100
        G1 Y10 F1200
    {% endif %}

    {% if HOME_X is defined %}
        SET_TMC_CURRENT STEPPER=stepper_x CURRENT={HOME_CUR}
        G28 X
        SET_TMC_CURRENT STEPPER=stepper_x CURRENT={RUN_CUR}
        BEEP I=1 DUR=100
        G1 X10 F1200
    {% endif %}

    {% if HOME_Z is defined %}
        G90
        G1 X120 Y120 F7800
        G91
        G28 Z

        {% if not printer.z_tilt.applied %}
            Z_TILT_ADJUST
        {% endif %}

        G90
        G1 X120 Y120 F7800
        G1 Z10 F600
    {% endif %}

    M204 S10000
    G90
